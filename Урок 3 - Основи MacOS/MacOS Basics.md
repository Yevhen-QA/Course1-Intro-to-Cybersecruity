## 1. Файлова система
Файлова система схожа на Лінукс, тому в кожного користувача є своя юзерська рут-папка, а рут директорія всієї ОС має багато спільних директорій з Лінуксом. На відміну від Лінукса, користувач з адмін привілеями має менше прав у МакОС. Наприклад, в адміна на МакОС є тільки права читання до папки System, і немає можливості щось там редагувати. Таким чином операційна система захищає себе від постороннього втручання, і адміністратор МакОС не є “наймогутнішою” сутністю в цій ОС.
У домашній папці користувача МакОС `/Users/username` ви знайдете частково знайомі з лінукса папки: Applications, Desktop, Documents, Downloads, Library, Movies, Music, Pictures, Public.
У рутовій директорії `/` також є частково схожі з лінуксом папки: Applications, Library, System, Users, Volumes, bin, cores, dev, etc, home, opt, private, sbin, tmp, usr, var.
Системні програми та утиліти можна знайти у `/System/Applications`.
Ядро МакОС знаходиться у `/System/Library/Kernels/kernel`.

Детальніше про найважливіші директорії:
```
/Applications: Інстальовані користувачем програми зберігаються тут. Всі користувачі МакОС мають доступ в цю директорію.
/bin: Програми команд терміналу.
/etc: Конфігураційні файли.
/sbin: Життєвонеобхідні програми операційної системи.
/System: Файли операційної системи MacOS.
/var: Файли з логами
```

## 2. Привілеї
`Standard User`: Базовий користувач. Не здатен самостійно встановлювати нові програми чи виконувати адміністративні дії.
`Admin User`: Користувач, який зазвичай використовує привілеї Standard User, але також здатен виконувати рутові, адміністративні дії накшталт встановлення нових програм. Всім користувачам що належать групі admin надає ться доступ до привілеїв root через sudoers файл.
`Root`: Найпотужніший користувач МакОС, який здатен виконувати майже будь-які дії (МакОС обмежує доступ до своїх системних папок щоб захистити себе). Для прикладу, root корсиутвач не зможе додати новий файл у папку /System. 

## 3. Вбудовані інструменти та механізми безпеки
### Gatekeeper
Задача Gatekeeper полягає в тому, щоб тільки довірені програми встановлюватись і запускались на МакОС. Gatekeeper запускається коли користувач завантажує та відкриває нову програму, плагін або інсталяційний пакет не з App Store. Gatekeeper перевіряє щоб скачана програма була підписана офіційним розробником, зареєстрованим в Apple, була завірена (нотаризована) Apple на предмет відсутності шкідливого коду, а також перевіряє цілісність пакету. Gatekeeper також вимагає підтвердження від користувача перед запуском скачаної програми в перший раз, щоб впевнитись що користувача не змусили обманом запустити цю програму.
Спробуйте скачати та встановити застосунок ProtonVPN з офіційного сайту, не apple store, щоб відпрацював Gatekeeper.

### Нотарізація
Для того щоб отримати нотарізацію, або завірення від Apple, розробник має відправити код своєї програми на review в Apple. Нотаріальний сервіс Apple - це автоматична система, що сканує код розробників на предмет шкідливого коду, перевіряє наявність проблема з підписом коду, і швидко повертає рузультат. Якщо проблем не було виявлено, нотаріальний сервіс генерує тікет який прикріплюється до програми розробників. Нотаріальний сервіс також публікує цей тікет онлайн, щоб Gatekeeper його міг побачити.

### Карантин файлів
Gatekeeper базується на картантині файлів.
Після скачування нової програми, Gatekeeper може додати спеціальний атрибут до неї - флаг File quarantine. Цей атрибут додається тією програмою, яка скачала файл (наприклад, веб браузер або поштовий клієнт).
Коли користувач запускає "карантинний" файл, Gatekeeper виконує своє перевірки перед тим як дозволити файлу запуститись.

### XProtect
X-Protect - це частина Gatekeeper. Це вбудований сканєр шкідливого коду від Apple. Він має базу з хешами та патернами шкідливих програм про які знає Apple.

### MRT: Malware Removal Tool
Якщо малварь (шкідлива програма, походить від MALicious softWARE) все ж таки потрапляє на МакОС, MRT буде боротись з цією інфекцією. MRT регулярно отримує оновлення про нові загрози від Apple. MRT видаляє малварь після отримання оновленої інформації про інфекції від Apple, і постійно шукає малварь при рестарті та логіні.

### Автоматичні оновлення безпеки
Apple постійно відправляє оновлення безпеки для своїх програм MRT та XProtect, базуючись на свіжий threat intelligence. За замовчуванням, macOS щодня перевіряє найявність оновлень безпеки. Оновлення нотарізації отримуються через CloudKit і відбуваються набагато частіше.

### TCC (Transparency, Consent, and Control) 
Цей механізм МакОС обмежує та контролює доступ програм до деяких фічєй, особливо тих що повʼязані з приватністю. Це включає такі сервіси як геолокацію, контакти, фото, мікрофон, камеру, повний доступ до диску, та інше.
Користувачі МакОС бачать TCC в роботі коли якась програма хоче отримати доступ до фічі під захистом TCC. Коли це трапляється, користувачу випливає вікно що запитує, чи точно хоче він дати цій програмі доступ до конкретних фічєй. Відповідь користувача зберігається у базі TCC. 

### Seatbelt Sandbox
MacOS Sandbox (пісочниця) прцює з розширенням ядра Seatbelt. Це означає що програми, запущені у пісочниці, мають запитувати доступ до ресурсів поза пісочниці. Це обмежує програми до доступу тільки до тих ресурсів які вона мала б бачити, а будь-що інше треба запитувати у користувача.
Важливі системні сервіси працюют ь всередині своїх особливих пісочниць, наприклад сервіс mdnsresponder. Ви можете переглянути ці профілі пісочниці у папці `/usr/share/sandbox`.

### SIP - System Integrity Protection
Цей механізм існує для захисту операційної системи від малварі, якій вдалось отримати привілеї root. У root користувача нема прав на зміну ось цих системних папок:
```
/System
/bin
/sbin
/usr
```

## 3. System32 у MacOS
Як і Windows, у МакОС є свої вбудовані системні програми, більшість з яких не взаємодіє з користувачем напряму. У Windows такі програми лежать у `C:\Windows\system32`. У МакОС їх можна знайти у `/System/Library/CoreServices`. Серед цих програм є і ті, з якими користувачі взаємодіють щодня (e.g., Finder, iCloud). 
 
## 4. Сервіси (Демони, Daemons)
В МакО, як і у Windows, є сервіси - процеси які запущені на задньому фоні без графічного інтерфейсу. В МакОС такі сервіси називаються Демони (Daemons). Прикладом демону можу бути SSH демон, що тримає SSH сервер постійно запущеним. Демонами (сервісами) на МакОС керує утиліта `launchctl` (аналог systemctl в Ubuntu). Подивитись всі встановлені сервіси на маку можна командою `launchctl list`. 

## 5. Процеси
Перший процес який стартує всю МакОС це launchd, PID якого зажди 1. Він, в свою чергу, запускає інші процеси. Аналогом цього процесу у Windows є System з PID 4. Подивитись список процесів можна командою `ps aux`.

## 6. Пакетний менеджер
Пакетний менеджер - це набір інструментів які автоматизовують процес встановлення, оновлення, конфігурації, та видалення програм на компʼютері. Пакетний менеджер працює з пакетами (софт в файлах-архівах). Пакетні менеджери, такі як yum, apt, pacman, dpkg, зазвичай вже встановлені в ОС і використовуються для менедженту програм в цій ОС. В цих пакетних менеджерів є списки репозиторіїв з яких вони викачують пакети(архіви). В Ubuntu такий список apt можна подивитись у /etc/apt/sources.list. Коли ви кажете apt встановити якусь програму (наприклад, nginx), apt перевірить у списку репозиторіїв чи має хтось з них nginx. В МакОС по замовчуванню нема свого паакетного менеджера, для більшості задач підходить App Store. Проте, коли користувач взаємодіє з МакОС саме як з лінуксом - в нього випливає необхідність використовувати пакетний менеджер і встановлювати пакети. Для цього можна використати Homebrew. Це найпопулярніший пакетний менеджер МакОС, інструкції по встановленню і використанню є на офіційному сайті - https://brew.sh/

## 7. Ядро
В серці ядра МакОС стоїть XNU. XNU- це збірна солянка що складається зі шматків Mach ядра (Open Software Foundation Mach kernel (OSFMK)) зі шматками коду Berkeley Software Distribution (BSD) та компонентом що відповідає за драйвери під назвою I/O Kit. Вихідний код XNU публічно доступний - https://opensource.apple.com/source/xnu/

## 8. Додаткові ресурси та матеріали
https://book.hacktricks.xyz/macos-hardening/macos-security-and-privilege-escalation
